<div class="container mt-5">
  <div class="row">
    <div class="col-12 post-show-header">
      <div class="post-show-tilte mr-auto"><h1><%= @post.title %></h1></div>
      <div class="post-show-control">
        <a class="btn btn-outline-primary mr-1 align-self-center">collect</a>
      <a class="btn btn-outline-primary align-self-center">comment</a>
      </div>
      
    </div>
  </div>
  <div class="row">
    <div class="col-3 border p-5">
      <div class="m-4"> <%= render partial:'/share/post_user_block',locals:{ user: @post.author } %></div>
     
      </div>
    <div class="col-9 border p-4">
      <div class="post-show-field">
        <div class="post-show-img"><%=image_tag @post.image %></div>
        <div class="post-show-content"><%=simple_format @post.content %></div>
      </div>
      <% if @post.author == current_user %>
      <div class="float-right"><%= link_to edit_post_path(@post) ,class:'btn btn-outline-secondary' do %><span class="fa fa-pencil" aria-hidden="true"></span>
      <%end%>
      <%= link_to post_path(@post), method: :delete, data:{confirm:'Are you sure?'} ,class:'btn btn-outline-secondary' do%>
        <i class="fa fa-trash-o" aria-hidden="true"></i>
      <%end%></div>
      <%end%>
    </div>
  </div>

  <!-- show comment -->
  <%@comments.each do |comment| %>
  <div class="row bg-light">
    <div class="col-3 border p-5">
       <div class="m-4">
        <%= render partial:'/share/post_user_block',locals:{ user: comment.author } %>
      </div>
    </div>
    <div class="col-9 border p-4"  data-id="<%=comment.id%>">
      <div class="post-show-field">
        <div class="post-show-content"><%=simple_format comment.content %></div>
      </div>
      <% if comment.author == current_user %>
      <div class="float-right"> 
        <div class="btn btn-outline-secondary comment-edit-btn"><span class="fa fa-pencil" aria-hidden="true"></span></div>
        <%= link_to post_comment_path(comment), method: :delete, data:{confirm:'Are you sure?'} ,class:'btn btn-outline-secondary' do%>
        <i class="fa fa-trash-o" aria-hidden="true"></i>
        <%end%>
      </div>
      <%end%>
    </div>
  </div>
  <%end%>
  <!-- post commnet -->


  <div class="row d-flex justify-content-center p-3 mb-5  border">
      <div class="post-comment">
        <%= simple_form_for [@post,@comment] do |f| %>
        <%=f.input :content , label: false,placeholder: 'add comment'%>
        <%=f.button :submit,class:'btn btn-outline-secondary' %>
        <%end%>
      </div>
    </div>
</div>


<script>
  if($('.comment-edit-btn').length >0){
    $('.comment-edit-btn').on('click',(e) =>{
      var comment_id = e.currentTarget.parentNode.parentNode.dataset.id;
      console.log(comment_id);
      $.ajax({
        url: "/posts/<%=@post.id%>/comments/"+ comment_id + "/edit",
        method: "GET",
        dataType: "json",
        success: function(data) {
          var textColumn = $("[data-id=" + comment_id + "]").find(".post-show-content");
          textColumn.html($("#edit-template").html());
          textColumn.find(".update-content").val(data["content"]);
          textColumn.on("click",".update-button", (e)=>{
            e.preventDefault();
            console.log(textColumn.find(".update-content").val());
            $.ajax({
              url: "/posts/<%=@post.id%>/comments/" + comment_id,
              method: "PATCH",
              dataType: "json",
              data: { 
                comment : {
                  content : textColumn.find(".update-content").val()
                }
              },
              success: function(updateData) {
                console.log(updateData)
                let textColumn = $("[data-id=" + comment_id + "]").find(".post-show-content");
                textColumn.html(updateData["content"]);
              }
            });
          });
        }

      });
    });
  }
  

</script>

<script type="text/template" id="edit-template">

  <form>
    <div class="form-group text optional comment_content">
      <textarea class="form-control text optional update-content" placeholder="add comment" name="comment[content]" ></textarea>
    </div>
        <button class="btn btn-outline-secondary update-button" type="button">update</button>
    </div>

    
  </form>
</script>